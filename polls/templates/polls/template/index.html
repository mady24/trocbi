{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{% static 'bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <title>TrocBi</title>
    <style>
        body {
            margin-top: 0;
        }

        input[type=submit] {
            bottom: 0;
            position: absolute;
        }

        @media screen and (max-width: 1000px) {
            input[type=submit] {
                bottom: 0;
                position: relative;
                ;
            }
        }
    </style>
</head>

<body>

    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
            <a class="navbar-brand" href="/"><img src="{% static 'img/logo.png'%}" alt="" style="height:40px;"></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ml-auto">
                    <!--<li class="nav-item">
                        <a class="nav-link scrolle btn btn-primary" {% if user.is_authenticated %} href="/passerannonce"
                            {% else %} href="/login" {% endif %}>Déposer une annonce</a>
                    </li>
                    <li class="nav-item" style="border-right: #000 solid 1px;">
                        <a class="nav-link" href="#search"><i class="fa fa-search"
                                style="font-size: 20px; font-weight:lighter;"></i></a>
                    </li>-->
                    {% if user.is_authenticated %}
                    <li class="nav-item">
                        <a class="nav-link" href="#">Mes favoris</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            {% if user.profile.avatar.url == '' %}
                            <img id="pp" src="{% static 'img/user.png' %}" alt="" style="height:20px;">
                            {% else %}
                            <img id="pp" src="{{user.avatar.avatar.url}}" alt=""
                                style="height:20px; border-radius: 50%;">
                            {% endif %}
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="profile">Mon profil</a>
                            <a class="dropdown-item" href="logout">Deconnexion</a>
                        </div>
                    </li>
                    {% else %}
                    <li class="nav-item">
                        <a class="nav-link btn btn-fith" href="login">Se Connecter</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link btn btn-secondary" href="signup">Inscription</a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </nav>
    </header>
    <div id="myCarousel" class="carousel slide" data-ride="carousel">
        <ol class="carousel-indicators">
            <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
            <li data-target="#myCarousel" data-slide-to="1"></li>
        </ol>
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img class="bd-placeholder-img"
                    src="{% static 'img/close-up-photo-of-smiling-girl-covering-mouth-1445465.png' %}" width="100%"
                    height="100%">
                <div class="container">
                    <div class="carousel-caption text-left">
                        <h1 class="slog">
                            Troquez , Economisez ,<span> Profitez</span>
                        </h1>
                        <div class="spacer"></div>
                        <h1 class="descrip">
                            Votre premier réseau collaboratif<br>de troc au <span>Sénégal</span>
                        </h1>
                        <div class="spacer1"></div>
                        <p><a {% if user.is_authenticated %} href="/passerannonce" {% else %} href="/login" {% endif %}
                                class="btn btn-third">Déposer une annonce</a></p>
                    </div>
                </div>
            </div>
            <div class="carousel-item">
                <img class="bd-placeholder-img" width="100%" height="100%"
                    src="{% static 'img/woman-in-black-coat-standing-on-sidewalk-3765160.png' %}">
                <div class="container">
                    <div class="carousel-caption text-left">
                        <h1 class="slog">
                            Troquez , Economisez ,<span> Profitez</span>
                        </h1>
                        <br>
                        <br>
                        <h1 class="descrip">
                            Votre premier réseau collaboratif<br>de troc au <span>Sénégal</span>
                        </h1>
                        <br>
                        <br>
                        <br>
                        <p><a {% if user.is_authenticated %} href="/passerannonce" {% else %} href="/login" {% endif %}
                                class="btn btn-third">Déposer une annonce</a></p>
                    </div>
                </div>
            </div>
            <!--<div class="carousel-item">
                <svg class="bd-placeholder-img" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img"><rect width="100%" height="100%" fill="#777"></rect></svg>
                <div class="container">
                  <div class="carousel-caption text-right">
                    <h1 class="slog">
                        Troquez, Economisez,<br><span>Profitez</span>
                    </h1>
                    <h1 class="descrip">
                        Votre premier réseau collaboratif<br>de troc au <span>Sénégal</span>
                    </h1>
                    <p><a class="btn btn-lg btn-primary" href="#" role="button">Browse gallery</a></p>
                  </div>
                </div>
              </div>-->
        </div>
        <a class="carousel-control-prev" href="#myCarousel" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#myCarousel" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </a>
    </div>
    <!--<div class="content">
            <div class="slogan">
                <h1 class="slog">
                    Troquez, Economisez,<br><span>Profitez</span>
                </h1>
                <h1 class="descrip">
                    Votre premier réseau collaboratif<br>de troc au <span>Sénégal</span>
                </h1>
            </div>
            <div class="post">
                <a {% if user.is_authenticated %} href="/passerannonce" {% else %} href="/login" {% endif %}
                    class="btn btn-third btn-lg">Déposer une annonce</a>
            </div>
        </div>-->

    <div class="search" id="search" align='center'>
        <div class="searchForm" align="center">
            <form action="search/" method="POST">
                {% csrf_token %}
                <div class="row form">
                    <div class="col-lg-3">
                        <select name="categorie" id="" class="form-control">
                            {% for prop in sousFamille %}
                            <option>{{ prop.sous_famille}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-lg-6">
                        <input type="text" name="searched" id="searched" class="form-control"
                            placeholder="Que recherchez-vous?">
                        <div class="result" id='replaceable-content'
                            style="background-color: #FFF; min-width: 100%; position: absolute;">
                            {% include 'polls/template/result.html' %}
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <input type="submit" value="Rechercher" class="btn btn-fourth btn-block">
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="categorie">
        <div class="row" align="center">
            {% for p,n in sf %}
            <div class="col-lg-4" align="center">
                <div class="row cat" style=" padding-bottom: 5%;">
                    <div class="row">
                        <!--<div class="col-lg-6">-->
                            <div class="catImg" align="center">
                                <div class="im">
                                    <img src="{{p.image.url}}" alt="">
                                </div>
                            </div>
                        <!--</div>
                        <div class="col-lg-6">-->

                            <h3 class="catTitle">{{p.sous_famille}}</h3>
                        <!--</div>-->
                    </div>
                    <div class="row" style="min-width: 100%;">
                        <div class="col-lg-6" style="min-width: 50%;">

                        </div>
                        <div class="col-lg-6">
                            <ul class="catSub">
                                {% for no in n %}
                                <li>{{no.nature}}</li>
                                {% endfor %}


                            </ul>
                            <button class="btn btn-fith" onclick="linkToCat('{{ p.id }}')"><i
                                    class="fa fa-long-arrow-right"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="row" align="center" style="margin-top: 5%;">
            {% for p,n in sf1 %}
            <div class="col-lg-4" align="center">
                <div class="row cat" style=" padding-bottom: 5%;">
                    <div class="row">
                        <!--<div class="col-md-6 col-sm-6">-->
                            <div class="catImg" align="center">
                                <div class="im">
                                    <img src="{{p.image.url}}" alt="">
                                </div>
                            </div>
                        <!--</div>
                        <div class="col-md-6 col-sm-6">-->

                            <h3 class="catTitle">{{p.sous_famille}}</h3>
                        <!--</div>-->
                    </div>
                    <div class="row" style="min-width: 100%;">
                        <div class="col-lg-6 col-sm-6" style="min-width: 50%;">

                        </div>
                        <div class="col-lg-6 col-sm-6">
                            <ul class="catSub">
                                {% for no in n %}
                                <li>{{no.nature}}</li>
                                {% endfor %}


                            </ul>
                            <button class="btn btn-fith" onclick="linkToCat('{{ p.id }}')"><i
                                    class="fa fa-long-arrow-right"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="row" align="center" style="margin-top: 5%;">
            {% for p,n in sf2 %}
            <div class="col-lg-4" align="center">
                <div class="row cat" style=" padding-bottom: 5%;">
                    <div class="row">
                        <!--<div class="col-md-6">-->
                            <div class="catImg" align="center">
                                <div class="im">
                                    <img src="{{p.image.url}}" alt="">
                                </div>
                            </div>
                        <!--</div>
                        <div class="col-md-6">-->

                            <h3 class="catTitle">{{p.sous_famille}}</h3>
                        <!--</div>-->
                    </div>
                    <div class="row" style="min-width: 100%;">
                        <div class="col-lg-6 col-md-6 col-sm-6 col-6" style="min-width: 50%;">

                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6 col-6 sub">
                            <ul class="catSub">
                                {% for no in n %}
                                <li>{{no.nature}}</li>
                                {% endfor %}


                            </ul>
                            <br>
                            <button class="btn btn-fith catSubBtn" onclick="linkToCat('{{ p.id }}')"><i
                                    class="fa fa-long-arrow-right"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="titleRecent">
        <img src="{% static 'img/loudspeaker.png' %}" alt="">
        <div class="heading">
            <h4>Il est temps de découvrir </h4>
            <h1>les dernières offres</h1>
        </div>
    </div>
    <div class="recent">
        {% if prop %}

        {% for prop in prop %}
        <div class="row recentItem" onclick="linkTo('{{ prop.id }}')">
            <div class="col-lg-4 recentImg">
                {% if prop.image1.url != null %}
                <img src="{{prop.image1.url}}" alt="">
                {% else %}
                <img src="{% static 'img/not-found.png' %}" alt="">
                {% endif %}
            </div>
            <div class=" col-lg-8 recentDetails">
                <h3 class="recentDetailsTitle">
                    {{ prop.name}}
                </h3>
                <div class="recentDetailsDescrip">
                    <h6 class="recentDetailsDescripSub">
                        {{prop.l_descrip}}
                    </h6>
                    <h6 class="recentDetailsDescripAddress">
                        {{prop.user.profile.address}}
                    </h6>
                </div>
                <h1 class="Price">
                    {{ prop.prix_achat}}
                </h1>
                <h6 class="owner">
                    {{prop.user}}
                </h6>
                <h6 class="ref">
                    {{prop.id}}
                </h6>
                <h6 class="miseEnLigne">
                    Mise en ligne: {{ prop.pub_date}}
                </h6>
                {% if prop.typeProp == 'offre' %}
                <h5
                    style="text-align: center; border-radius: 20px; background-color: #FA303E; width: 15%; right: 0% !important; left: inherit; float: right; color: #FFF; padding: 3px;">
                    Offre</h5>
                {% else %}
                <h5
                    style="text-align: center; border-radius: 20px; background-color: #F2BB03; width: 15%; right: 0% !important; left: inherit; float: right; color: #FFF; padding: 3px;">
                    Deman</h5>
                {% endif %}
            </div>
        </div>
        {% endfor %}
        {% else %}
        <p>No polls are available.</p>
        {% endif %}
        <div class="row" align="center">
            <div class="col-lg-4"></div>
            <div class="col-lg-4" style="margin-top: 3%; padding-left: 5%; padding-right: 3%;"><a href="/list"
                    class="btn btn-third btn-block">Voir Plus +</a></div>
        </div>
    </div>
    <div class="titleRecents">

        <div class="headings">
            <h1>Les meilleurs ventes</h1>
        </div>
        <img src="{% static 'img/handshake.png' %}" alt="">
    </div>
    <!--<div class="newsletter">
        <div class="textletter">
            <h1 class="letterTitle">Newsletter</h1>
            <p class="textnews">
                Veuillez entrer votre email afin de souscrire à notre newsletter
            </p>
            <form action="">
                <div style="display: flex;"><input type="text" name="" id=""
                        style="width: 80%; border-top-right-radius: 0px; border-bottom-right-radius: 0px; background-color: rgba(255,255,255,.16); border: 1px #000 solid;"
                        class="form-control"><button type="submit"
                        style="width: 20%; border-top-left-radius: 0px; border-bottom-left-radius: 0px; border-top-right-radius: 5px; border-bottom-right-radius: 5px; border: #000 solid 1px;"
                        value="" class="btn-big btn-third"><i class="material-icons">send</i></button></div>
            </form>
            <p class="textsuccess"><span>&#10004;</span>Votre email a été sauvegardé avec succès , Merci et à très
                bientôt</p>
        </div>
        <div class="imageletter">

        </div>
    </div>
    <div class="cu">
        <h1>Contactez Nous</h1>
    </div>
    <div class="cuf">
        <form action="" method="post">
            <div class="row" style="margin-top: 2%;">
                <div class="col-lg-6">
                    <label for="fname">Prénom</label>
                    <input type="text" name="" id="fname" placeholder="Babacar" class="form-control">
                </div>
                <div class="col-lg-6">
                    <label for="lname">Nom</label>
                    <input type="text" name="" id="lname" placeholder="Sall" class="form-control">
                </div>
            </div>
            <div class="row" style="margin-top: 2%;">
                <div class="col-lg-6">
                    <label for="message">Message</label>
                    <textarea name="" id="mesage" cols="30" placeholder="Votre message ici" rows="10"
                        class="form-control"></textarea>
                </div>
                <div class="col-lg-6">
                    <div class="row">
                        <div class="col">
                            <label for="tel">Numéro de téléphone</label>
                            <input type="tel" name="" id="tel" placeholder="778239231" class="form-control">
                        </div>
                    </div>
                    <div class="row">
                        <input type="submit" value="Envoyer" class="btn btn-third">
                    </div>
                </div>
            </div>
        </form>
    </div>-->
    <div class="newsletter">
        <div class="row">
            <div class="col-lg-6">
                <div class="row">
                    <div class="col-md-8">
                        <h1 style="text-align: center;">A Propos</h1>
                        <p style="font-size: 20px; text-align: center;">TrocBi est un site de
                            e-commerce qui vous permettra de troquer vos objets en toute facilité avec une interface
                            simple accessible pour toutes les couches de la population , profitez juste …</p>
                    </div>
                </div>
                <br>
                <br>
                <div class="row">
                    <div class="col-md-8">
                        <h1 style="text-align: center;">Envoyez nous E-mail à:</h1>
                        <h4 style="text-align: center;">infos@trocbi.com</h4>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="textletter">
                    <br><br>
                    <div class="row">
                        <div class="col-md-5">
                            <h1 class="letterTitle">Newsletter</h1>
                        </div>
                        <div class="col-md-7">
                            <img src="{% static 'img/Union4.png' %}" alt="" style="height: 50px;">
                        </div>
                    </div>
                    <br>
                    <br>
                    <p class="textnews" id="newstext">
                        Veuillez entrer votre email afin de souscrire à notre newsletter
                    </p>
                    <form action="/#newstext" method="POST">
                        {% csrf_token %}
                        <div style="display: flex;"><input type="text" name="news" id="news"
                                style="width: 80%; border-top-right-radius: 0px; border-bottom-right-radius: 0px; background-color: rgba(255,255,255,.16); border: 1px #000 solid; color: #FFF;"
                                class="form-control"><button type="submit"
                                style="width: 20%; border-top-left-radius: 0px; border-bottom-left-radius: 0px; border-top-right-radius: 5px; border-bottom-right-radius: 5px; border: #000 solid 1px;"
                                value="" class="btn-big btn-third"><i class="material-icons">send</i></button></div>
                    </form>
                    {% if nss == 'good' %}
                    <p class="textsuccess"><span>&#10004;</span>Votre email a été sauvegardé avec succès , Merci et à très bientôt</p>
                    {% elif nss == 'bad' %}
                    <p class="textsuccess"><span>&#10060;</span>Une erreur est survenue veuillez réessayer!!!</p>
                    {% else%}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div class="footer black">
        <div class="row" style="width: 100%;">
            <div class="col-lg-6 social">
                <ul class="su">
                    <li><a href=""><i class="fa fa-facebook-square"></i></a></li>
                    <li><a href=""><i class="fa fa-twitter"></i></a></li>
                    <li><a href=""><i class="fa fa-instagram"></i></a></li>
                </ul>
            </div>
            <div class="col-lg-6 nc">
                Contact Number: 00221773832393
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="{% static 'bootstrap.bundle.min.js'%}"></script>
    <script src="{% static 'popper.min.js'%}"></script>
    <script>
        $(function () {
            $(document).scroll(function () {
                var give = $(".post");
                var height = give.offset();
                var h = height.top;
                var m = h / 6;
                var nl = $(".newsletter");
                var height1 = nl.offset();
                //alert('higt:'+h+'h_30' +m);
                var $nav = $(".nav");
                var scrolle = $(".scrolle");
                $nav.toggleClass('scrolled', $(this).scrollTop() > $nav.height());
                $(body).css('margin-top', '70px', $(this).scrollTop() > $nav.height());
                give.toggleClass('scrolled', $(this).scrollTop() > (m));
                if ($(this).scrollTop() > height.top) {
                    //alert('true');
                    scrolle.css('display', 'block');
                } else {
                    scrolle.css('display', 'none');
                }
                if ($(this).scrollTop() > height1.top) {
                    //alert('true');
                    $nav.css('background-color', 'rgba(255,255,255,.3)');
                } else {
                    if ($(this).scrollTop() > $nav.height()) {
                        $nav.css('background-color', 'rgba(0,0,0,.3)');
                    } else {
                        $nav.css('background-color', '');
                    }
                }
            });
        });

        function linkTo(id) {
            window.location.href = "/" + id + "/";
        }

        function linkToCat(cat) {
            window.location.href = "/cat/" + cat;
        }

        function myFunction() {
            document.getElementById("myDropdown").classList.toggle("show");
        }

        // Close the dropdown menu if the user clicks outside of it
        window.onclick = function (event) {
            if (!event.target.matches('.dropbtn')) {
                var dropdowns = document.getElementsByClassName("dropdown-content");
                var i;
                for (i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }

        var url = window.location.pathname;
        var id = url.substring(url.lastIndexOf('/') + 1);

        if (id == '#search') {
            document.getElementById('search').style.marginTop == '10%';
        }

        const user_input = $("#searched")
        //const search_icon = $('#search-icon')
        const artists_div = $('#replaceable-content')
        const endpoint = '/search/'
        const delay_by_in_ms = 700
        let scheduled_function = false

        let ajax_call = function (endpoint, request_parameters) {
            $.getJSON(endpoint, request_parameters)
                .done(response => {
                    // fade out the artists_div, then:
                    artists_div.fadeTo('slow', 0).promise().then(() => {
                        // replace the HTML contents
                        artists_div.html(response['html_from_view'])
                        // fade-in the div with new contents
                        artists_div.fadeTo('slow', 1)
                        // stop animating search icon
                        //search_icon.removeClass('blink')
                    })
                })
        }


        user_input.on('keyup', function () {

            const request_parameters = {
                q: $(this).val() // value of user_input: the HTML element with ID user-input
            }

            // start animating the search icon with the CSS class
            //search_icon.addClass('blink')

            // if scheduled_function is NOT false, cancel the execution of the function
            if (scheduled_function) {
                clearTimeout(scheduled_function)
            }

            // setTimeout returns the ID of the function to be executed
            scheduled_function = setTimeout(ajax_call, delay_by_in_ms, endpoint, request_parameters)
        })
    </script>
</body>

</html>